#!/bin/bash
# vim: set filetype=sh softtabstop=2 shiftwidth=2 smarttab cindent:
yesno() {
  local yn cmd msg="${1:-OK? [y/N]} "
  case $1 in
    -c)
      shift
      cmd="$@"
      msg="$* [y/N] "
      ;;
  -h|-\?|--help)
    echo 'usage: yesno "prompt"'
    echo '       yesno -c command arg1 arg2 ...'
    return
    ;;
  esac
  read -r -p "$msg" yn
  case $yn in
    Y|y|yes)
      $cmd
      true
      ;;
    *)
      false
      ;;
esac
}

# init home dir
cd ~
mkdir save log backup install
if mkdir orig; then
  sudo cp -p .* orig/        || cp -p .* orig/
  sudo cp -pr /etc orig/etc  || cp -pr /etc orig/etc
  dpkg --get-selections > orig/pkg-selections.log
  alias    > orig/alias.log
  printenv > orig/printenv.log
  apt list > orig/apt-list.log
  groups   > orig/groups.log
fi
# install minimum package
yesno -c sudo add-apt-repository ppa:git-core/ppa
sudo apt update ; sudo apt full-upgrade
sudo apt install vim git tig zip
# install option package
cat > install/mypkg << 'EOF'
## un-comment if you need.
#sudo apt install ripgrep
#sudo apt install dos2unix nkf
#sudo apt install p7zip-full
#sudo apt install zstd
#sudo apt install rar
#sudo apt install xsel # need X11
#sudo apt install git-svn
#sudo apt install git-cvs
#sudo apt install subversion
#sudo apt install make
#sudo apt install build-essential libtool automake autoconf pkg-config
#sudo apt install cpanminus
#sudo apt install npm && npm -g install electron
#sudo apt install golang
#sudo apt install rustc
#sudo apt install lua5.3
#sudo apt install libimage-exiftool-perl
#sudo apt install libflickr-upload-perl
#sudo apt install astronomical-almanac
#sudo apt install terminator
#sudo apt install plantuml
#sudo apt install network-manager
#sudo apt install whois
#sudo apt install neovim
#sudo apt install ffmpeg
#sudo apt install imagemagick
#sudo apt install graphicsmagick
#sudo apt install graphicsmagick-imagemagick-compat
#sudo apt-get autoremove
EOF
vim install/mypkg ; source install/mypkg

# init shell and git
yesno -c git clone https://github.com/hkuno9000/cygbin.git bin
yesno -c git config --global user.name "Hiroshi Kuno"
yesno -c git config --global user.email "hkuno9000@gmail.com"
##curl https://raw.githubusercontent.com/git/git/master/contrib/completion/git-prompt.sh > bin/git-prompt.sh
yesno -c bash -c bin/initmyrc
yesno -c bash -c bin/initbashrc
vim -c '/^##' .bashrc
yesno -c bash -c bin/mygitconf
# end
